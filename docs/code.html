<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>code.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Warning systems soybean rust</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa fa fa-home"></span>
     
    About
  </a>
</li>
<li>
  <a href="code.html">
    <span class="fa fa fa fa-file-code-o"></span>
     
    Analysis
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/emdelponte/paper-sbr-warning-systems">
    <span class="fa fa-github-square"></span>
     
    source
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p>% Code</p>
<pre class="r"><code># Set the default theme for the ggplot2 plots
library(tidyverse)
library(cowplot)
theme_set(theme_minimal_hgrid())
library(ggthemes)
library(ggsci)</code></pre>
<div id="read-data" class="section level2">
<h2>Read data</h2>
<p>The data were organized in a Google sheet file which can be read directly using the <em>gsheet</em> package. See below the code that can be used to load the data from the cloud. I created a csv file for the data and either could be used.</p>
<pre class="r"><code>#library(gsheet)
#dataws &lt;- gsheet::gsheet2tbl(  &quot;https://docs.google.com/spreadsheets/d/1P3wzN-nQiSKBjfN9u_MADAAtTpBeyAObzhwVybD5b3w/edit#gid=931758392&quot;
#write_csv(dataws, &quot;data/dataws.csv&quot;)

dataws &lt;- read_csv(&quot;data/dataws.csv&quot;)</code></pre>
</div>
<div id="exploratory-analysis" class="section level2">
<h2>Exploratory analysis</h2>
<div id="experiments-and-treatments" class="section level3">
<h3>Experiments and treatments</h3>
<p>Let’s explore the data of the epidemic variables and yield in all experiments. We need the <em>tidyverse</em> package (loads a collection of several packages) to facilitate our analysis.</p>
<p>Number of experiments:</p>
<pre class="r"><code>max(dataws$trial_number)</code></pre>
<pre><code>## [1] 29</code></pre>
<p>Number of experiments by treatment and source:</p>
<pre class="r"><code>table(dataws$treatment, dataws$source)/4</code></pre>
<pre><code>##        
##         Beruski DWSys
##   CAL        24     5
##   DSV50      24     5
##   DSV80      24     5
##   DVIP6      24     0
##   DVIP9      24     0
##   UNT        24     5</code></pre>
<p>Number and percent of planting dates per month across all experiments.</p>
<pre class="r"><code>library(janitor)
dataws %&gt;% 
  tabyl(planting_month) %&gt;% 
    arrange(-n) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["planting_month"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["percent"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"Dec","2":"200","3":"0.30487805"},{"1":"Nov","2":"168","3":"0.25609756"},{"1":"Oct","2":"120","3":"0.18292683"},{"1":"Jan","2":"112","3":"0.17073171"},{"1":"Feb","2":"56","3":"0.08536585"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Number of trials with soybean rust severity.</p>
<pre class="r"><code>dataws %&gt;% 
  filter(sev &gt; 0) %&gt;% 
  tabyl(trial_number) %&gt;% 
  nrow()</code></pre>
<pre><code>## [1] 21</code></pre>
<p>Number of trials with AUDPC.</p>
<pre class="r"><code>dataws %&gt;% 
  filter(audpc &gt; 0) %&gt;% 
  tabyl(trial_number) %&gt;% 
  nrow()</code></pre>
<pre><code>## [1] 16</code></pre>
<p>Number of trials where yield was obtained.</p>
<pre class="r"><code>dataws %&gt;% 
  filter(yld &gt; 0) %&gt;% 
  tabyl(trial_number) %&gt;% 
  nrow()</code></pre>
<pre><code>## [1] 28</code></pre>
</div>
<div id="disease-pressure" class="section level3">
<h3>Disease pressure</h3>
<p>We will filter the untreated check plots and inspect the variation in the mean and standard deviation of disease severity for each trial. This provides an overview of the “disease pressure”.</p>
<pre class="r"><code>p1_sev_trials &lt;- dataws %&gt;%
  filter(treatment == &quot;UNT&quot;) %&gt;%
  filter(sev &gt; 0) %&gt;%
  unite(&quot;treatment2&quot;, c(&quot;trial_number&quot;, &quot;trial_code&quot;), remove = F) %&gt;%
  group_by(trial_number, treatment2, harvest_season, trial_code) %&gt;%
  summarize(mean_sev = mean(sev), 
            sd_sev = sd(sev)) %&gt;%
  ggplot(aes(reorder(treatment2, harvest_season), mean_sev,
              shape = factor(harvest_season))) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = mean_sev - sd_sev, 
                    ymax = mean_sev + sd_sev), 
                width = 0.1) +
  theme(legend.position = &quot;none&quot;, 
         axis.text.x=element_blank()) +
   labs(
    y = &quot;UNT severity (%)&quot;,
    x = &quot;Trial&quot;,
    shape = &quot;Location&quot;, color = &quot;Harvest season&quot;
  )+
  ylim(0,106)+
  facet_wrap(~trial_code, scales = &quot;free_x&quot;, ncol=4)

p1_sev_trials</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="baseline-yield" class="section level3">
<h3>Baseline yield</h3>
<p>We do the same for what we call baseline yield, which is the actual yields for the situations where no fungicide was applied (yield in the check treatment).</p>
<pre class="r"><code>p1_yield_trials &lt;- dataws %&gt;%
  filter(treatment == &quot;UNT&quot;) %&gt;%
  filter(yld &gt; 0) %&gt;%
  unite(&quot;treatment2&quot;, c(&quot;trial_number&quot;, &quot;trial_code&quot;), remove = F) %&gt;%
  group_by(trial_number, treatment2, harvest_season, trial_code) %&gt;%
  summarize(mean_yld = mean(yld), sd_yld = sd(yld)) %&gt;%
  ggplot(aes(reorder(treatment2, harvest_season), mean_yld, 
             shape = factor(harvest_season))) +
  geom_point(size = 2) +
  geom_errorbar(aes(ymin = mean_yld - sd_yld, ymax = mean_yld + sd_yld),
                width = 0.1) +
  theme(legend.position = &quot;top&quot;,  axis.text.x=element_blank()) +
   labs(
    y = &quot;UNT Yield (kg/ha)&quot;,
    x = &quot;Trial&quot;,
    shape = &quot;Harvest season&quot;
  )+
    ylim(0, 7000)+
  scale_color_tableau()+
  facet_wrap(~trial_code, scales = &quot;free_x&quot;, ncol = 6)

p1_yield_trials</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="treatments" class="section level3">
<h3>Treatments</h3>
<p>Let’s recode the names of the treatments and assign them to three criteria: calendar or growth stage, rainfall and leaf wetness x temperature models. This category will be used to enhance visualization.</p>
<pre class="r"><code>dataws$treatment &lt;- factor(dataws$treatment,
  levels = c(
    &quot;UNT&quot;,
    &quot;CAL&quot;,
    &quot;DSV50&quot;,
    &quot;DSV80&quot;,
    &quot;DVIP6&quot;,
    &quot;DVIP9&quot;
  )
)


dataws$treatment_type &lt;- factor(dataws$treatment_type,
  levels = c(
    &quot;None&quot;,
    &quot;Growth stage&quot;,
    &quot;Rainfall&quot;,
    &quot;LWDxT&quot;
  )
)</code></pre>
</div>
<div id="overall-severity" class="section level3">
<h3>Overall severity</h3>
<p>Here we will produce a boxplot to depict the variation in severity for each of the treatments. It will provide an overview of the performance of the systems, irrespectively of the number of sprays.</p>
<pre class="r"><code>p1_sev &lt;- dataws %&gt;%
  filter(sev &gt; 0) %&gt;%
  ggplot(aes(treatment, sev, fill = treatment_type)) +
  geom_boxplot(alpha = 1, outlier.colour = NA) +
  geom_jitter(width = 0.1, shape = 1, color = &quot;grey30&quot;, alpha = 0.5)+
  theme(legend.position = &quot;none&quot;)+
   
geom_jitter(width = 0.1, size = 1, color = &quot;grey70&quot;, shape = 16, alpha = 0.5)+ theme(legend.position = &quot;none&quot;)+

 scale_fill_futurama() +
    ylim(0, 106)+
  labs(x = &quot;Treatment&quot;, y = &quot;SBR Severity (%)&quot;, fill = &quot;System&quot;)</code></pre>
</div>
<div id="overall-yield" class="section level3">
<h3>Overall yield</h3>
<p>We do the same for yield to compare the treatments with regards yied response.</p>
<pre class="r"><code>p1_yield &lt;- dataws %&gt;%
  filter(yld &gt; 0) %&gt;%
  ggplot(aes(treatment, yld, fill = treatment_type)) +
  geom_boxplot(alpha = 1, outlier.colour = NA) +
  
geom_jitter(width = 0.1, size = 1, color = &quot;grey70&quot;, shape = 16, alpha = 0.5)+ theme(legend.position = &quot;none&quot;)+
  theme(legend.position = &quot;none&quot;)+
  ylim(0, 7000)+
  scale_fill_futurama() +
  labs(x = &quot;Treatment&quot;, y = &quot;Soybean yield (kg/ha)&quot;, fill = &quot;System&quot;)</code></pre>
</div>
</div>
<div id="figure-1" class="section level2">
<h2>Figure 1</h2>
<p>Distribution of severity and yield across treatments.</p>
<pre class="r"><code>library(cowplot)

legend_b &lt;- get_legend(
p1_sev +
guides(color = guide_legend(nrow = 1)) +
theme(legend.position = &quot;bottom&quot;)
)

prow &lt;- plot_grid( p1_sev,p1_yield,  ncol = 1, align = &quot;h&quot;, axis = &quot;bt&quot;, labels = LETTERS )
plot_grid(prow, legend_b, ncol = 1, rel_heights = c(1, .1))</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-14-1.png" width="864" /></p>
<pre class="r"><code>ggsave(&quot;figs/figure1.png&quot;, dpi = 300, width =5, height =9)</code></pre>
<div id="number-of-sprays" class="section level3">
<h3>Number of sprays</h3>
<p>Let’s obtain the mean and median number of sprays per treatment.</p>
<pre class="r"><code>dataws %&gt;%
  filter(treatment != &quot;UNT&quot;) %&gt;%
  group_by( treatment_type, treatment) %&gt;%
  summarize(n_spray2 = median(n_spray),
            n_spray3 = mean(n_spray)) </code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["treatment_type"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["treatment"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["n_spray2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["n_spray3"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"Growth stage","2":"CAL","3":"4","4":"4.137931"},{"1":"Rainfall","2":"DSV50","3":"4","4":"3.413793"},{"1":"Rainfall","2":"DSV80","3":"2","4":"1.896552"},{"1":"LWDxT","2":"DVIP6","3":"5","4":"4.708333"},{"1":"LWDxT","2":"DVIP9","3":"4","4":"4.166667"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Another way is to use a jitter plot .</p>
<pre class="r"><code>dataws %&gt;%
  filter(treatment != &quot;UNT&quot;) %&gt;%
  group_by(trial_number, treatment_type, treatment, sev_class) %&gt;%
  summarize(n_spray2 = mean(n_spray)) %&gt;%
  ggplot(aes(treatment, n_spray2, color = treatment_type)) +
  theme_minimal_hgrid()+
  geom_jitter(width = 0.1, height = 0.1, size = 2)</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>mean_sprays &lt;- dataws %&gt;%filter(treatment != &quot;UNT&quot;) %&gt;%  group_by(treatment) %&gt;% summarize(mean_sprays = (mean(n_spray, na.rm = TRUE)))
mean_sprays</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["treatment"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["mean_sprays"],"name":[2],"type":["dbl"],"align":["right"]}],"data":[{"1":"CAL","2":"4.137931"},{"1":"DSV50","2":"3.413793"},{"1":"DSV80","2":"1.896552"},{"1":"DVIP6","2":"4.708333"},{"1":"DVIP9","2":"4.166667"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>p_sprays3 &lt;- dataws %&gt;%
  filter(treatment != &quot;UNT&quot;) %&gt;%
  ggplot(aes(x = n_spray, fill = treatment_type)) +
  theme_minimal_hgrid()+
  geom_bar()+
   geom_vline(data = mean_sprays, aes(xintercept = mean_sprays), size =1, linetype =2, color = &quot;grey50&quot;)+
  labs(x = &quot;Number of sprays&quot;, y = &quot;Frequency&quot;)+
scale_x_continuous(breaks = c(0,1,2,3,4,5,6))+
  scale_fill_manual(values = c(&quot;#c71000ff&quot;, &quot;#008ea0ff&quot;, &quot;#8a4198ff&quot;))+

  theme(legend.position = &quot;none&quot;)+
  facet_wrap(~treatment, ncol = 1)</code></pre>
<p>Days to first spray</p>
<pre class="r"><code>mean_first &lt;- dataws %&gt;%filter(treatment != &quot;UNT&quot;) %&gt;%  group_by(treatment) %&gt;% summarize(mean_first = (mean(first_after_planting, na.rm = TRUE)))

p_sprays2 &lt;- dataws %&gt;%
  filter(treatment != &quot;UNT&quot;) %&gt;%
  ggplot(aes(x = first_after_planting, fill = treatment_type)) +
  theme_minimal_hgrid()+
    scale_fill_manual(values = c(&quot;#c71000ff&quot;, &quot;#008ea0ff&quot;, &quot;#8a4198ff&quot;))+
  labs(y = &quot;Frequency&quot;, x = &quot;Days to first spray&quot;)+

  geom_histogram(bins = 10, color = &quot;white&quot;)+
  scale_x_continuous(breaks = seq(0,80, 10))+
  geom_vline(data = mean_first, aes(xintercept = mean_first), size =1, linetype =2, color = &quot;grey50&quot;)+
  theme(legend.position = &quot;none&quot;)+
    facet_wrap(~treatment, ncol = 1)</code></pre>
<p>Intervals between sprays</p>
<pre class="r"><code>p_sprays1 &lt;- dataws %&gt;% 
  filter(treatment != &quot;UNT&quot;) %&gt;% 
  select(treatment_type, treatment, 25:29) %&gt;% 
  gather(position, value, 3:7) %&gt;% 
  filter(value != &quot;NA&quot;) %&gt;% 
  
  ggplot(aes(position, value, fill = treatment_type))+
  geom_boxplot(outlier.shape = 1, alpha = 0.7, aes(color = treatment_type))+
  labs(y = &quot;Number of days&quot;, x = &quot;Spray interval&quot;)+
 scale_color_manual(values = c(&quot;#c71000ff&quot;, &quot;#008ea0ff&quot;, &quot;#8a4198ff&quot;))+
    scale_fill_manual(values = c(&quot;#c71000ff&quot;, &quot;#008ea0ff&quot;, &quot;#8a4198ff&quot;))+
  theme(legend.position = &quot;none&quot;)+
  facet_wrap(~treatment, ncol = 1)</code></pre>
</div>
</div>
<div id="figure-2" class="section level2">
<h2>Figure 2</h2>
<pre class="r"><code>plot_grid(p_sprays3,p_sprays2,p_sprays1, ncol = 3, align = &quot;hv&quot;, labels = LETTERS )</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;figs/figure2.png&quot;, width = 9, height =8)</code></pre>
<p>Now let’s calculate the mean and standard deviation of the number of sprays.</p>
<pre class="r"><code>theme_set(theme_minimal_hgrid())
mean_sprays &lt;- dataws %&gt;%
  filter(treatment != &quot;UNT&quot;) %&gt;%
  group_by(trial_number, treatment_type, treatment, sev_class) %&gt;%
  summarize(n_spray2 = mean(n_spray)) %&gt;%
  group_by(treatment, treatment_type) %&gt;%
  summarize(
    mean_spray2 = mean(n_spray2),
    sd_spray2 = sd(n_spray2),
    min_spray2 = min(n_spray2),
    max_spray2 = max(n_spray2)
  )

mean_sprays %&gt;%
  ggplot(aes(treatment, mean_spray2, color = treatment_type)) +
  geom_point(size = 3) +
  geom_errorbar(aes(ymin = mean_spray2 - sd_spray2, ymax = mean_spray2 + sd_spray2), width = 0.1, size = 1)+
  labs(x = &quot;System&quot;,
       y = &quot;Mean number of sprays&quot;,
       color = &quot;System type&quot;)</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-22-1.png" width="768" /></p>
</div>
<div id="fungicide-efficiency" class="section level2">
<h2>Fungicide efficiency</h2>
<p>The fungicide use efficiency is an index which takes into account the effect of the fungicide (usually reduction in disease compared to the nontreated check), as well as the number of sprays. In other words, if more sprays are needed for fungicide treatment A to reduce disease to the same level as fungicide treatment B, the less efficient is the fungicide treatment A.</p>
<p>Before we proceed with further analysis, let’s create columns with each of the values of severity and audpc in the check treatment of the trials, which will be needed for our analysis of efficiency for each of these two variables.</p>
<pre class="r"><code>library(tidyr)

sev_check &lt;- dataws %&gt;%
  filter(treatment == &quot;UNT&quot;) %&gt;%
  dplyr::select(trial_number, treatment, sev) %&gt;%
  group_by(trial_number) %&gt;%
  summarize(mean_sev_check = mean(sev))

datws2 &lt;- left_join(dataws, sev_check)


audpc_check &lt;- dataws %&gt;%
  filter(treatment == &quot;UNT&quot;) %&gt;%
  dplyr::select(trial_number, treatment, audpc) %&gt;%
  group_by(trial_number) %&gt;%
  summarize(mean_audpc_check = mean(audpc))

datws4 &lt;- left_join(dataws, audpc_check)</code></pre>
<p>We do the same for yield as well.</p>
<pre class="r"><code>yld_check &lt;- datws2 %&gt;%
  filter(treatment == &quot;UNT&quot;) %&gt;%
  dplyr::select(trial_number, treatment, yld) %&gt;%
  group_by(trial_number) %&gt;%
  summarize(mean_yld_check = mean(yld))
datws3 &lt;- left_join(datws2, yld_check)</code></pre>
<div id="severity" class="section level3">
<h3>Severity</h3>
<pre class="r"><code>datws2 %&gt;%
  filter(n_spray &gt; 0) %&gt;%
  mutate(treatment_eff = ((sev / mean_sev_check) / n_spray) * 100) %&gt;%
  filter(treatment != &quot;UNT&quot;) %&gt;%
  group_by(treatment) %&gt;%
  #summarize(mean_treatment_eff = mean(treatment_eff, na.rm = T)) %&gt;%
  ggplot(aes(treatment, treatment_eff)) +
  geom_boxplot(outlier.color = NA) +
  geom_jitter(width = 0.1)</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
<div id="audpc" class="section level3">
<h3>AUDPC</h3>
<p>Now we plot the same using the AUDPC values instead of final severity.</p>
<pre class="r"><code>datws4 %&gt;%
  filter(treatment != &quot;UNT&quot;) %&gt;%
  filter(n_spray &gt; 0) %&gt;% 
  mutate(treatment_eff2 = ((audpc / mean_audpc_check) / n_spray) * 100) %&gt;%
  group_by(trial_number, treatment) %&gt;%
  summarize(mean_treatment_eff2 = mean(treatment_eff2, na.rm = T)) %&gt;%
  ggplot(aes(treatment, mean_treatment_eff2)) +
  geom_boxplot(outlier.colour = NA) +
    geom_jitter(width = 0.05)</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
</div>
<div id="treatment-comparison" class="section level2">
<h2>Treatment comparison</h2>
<p>Here the idea is to estimate the mean response for each treatment using a mixed modelling approach. The approach is similar to meta-analysis where all trials are treated as a random effects in the model. We will use the <em>lme4</em> package for fitting the mixed model.</p>
<div id="severity-1" class="section level3">
<h3>Severity</h3>
<p>Let’s first fit the model for severity.</p>
<pre class="r"><code>library(lme4)
control_sev &lt;- datws2 %&gt;%
  mutate(effect_sev = log(sev / mean_sev_check +0.1))
fit1 &lt;- lmer(effect_sev ~ treatment + (1 | trial_number), data = control_sev)
summary(fit1)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: effect_sev ~ treatment + (1 | trial_number)
##    Data: control_sev
## 
## REML criterion at convergence: 571.8
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.1646 -0.6304  0.0505  0.6574  4.1834 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  trial_number (Intercept) 0.08459  0.2908  
##  Residual                 0.17321  0.4162  
## Number of obs: 464, groups:  trial_number, 21
## 
## Fixed effects:
##                Estimate Std. Error t value
## (Intercept)     0.09114    0.07804   1.168
## treatmentCAL   -1.05577    0.06422 -16.440
## treatmentDSV50 -0.88777    0.06422 -13.824
## treatmentDSV80 -0.51661    0.06422  -8.044
## treatmentDVIP6 -1.14176    0.07010 -16.287
## treatmentDVIP9 -0.98490    0.07008 -14.054
## 
## Correlation of Fixed Effects:
##             (Intr) trtCAL tDSV50 tDSV80 tDVIP6
## treatmntCAL -0.411                            
## trtmntDSV50 -0.411  0.500                     
## trtmntDSV80 -0.411  0.500  0.500              
## trtmntDVIP6 -0.377  0.458  0.458  0.458       
## trtmntDVIP9 -0.377  0.458  0.458  0.458  0.449</code></pre>
<p>Obtain the significance of the effect of treatments.</p>
<pre class="r"><code>library(car)
Anova(fit1)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"422.7985","2":"5","3":"3.610518e-89","_rn_":"treatment"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now we calculate the means and compare them statistically using the <em>emmeans</em> package. We then back-transform the estimate to obtain the percent control. Recall that the difference in the logs (the estimate is the difference to the first treatment which is the check) is the ratio.</p>
<pre class="r"><code>library(emmeans)
m1 &lt;- emmeans(fit1, &quot;treatment&quot;)
multcomp::cld(m1)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["treatment"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["emmean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"DVIP6","2":"-1.05062076","3":"0.08297202","4":"47.56165","5":"-1.21748691","6":"-0.8837546","7":"1","_rn_":"5"},{"1":"CAL","2":"-0.96463078","3":"0.07803986","4":"37.84127","5":"-1.12263598","6":"-0.8066256","7":"12","_rn_":"2"},{"1":"DVIP9","2":"-0.89376673","3":"0.08295205","4":"47.52420","5":"-1.06059614","6":"-0.7269373","7":"12","_rn_":"6"},{"1":"DSV50","2":"-0.79663407","3":"0.07803986","4":"37.84127","5":"-0.95463926","6":"-0.6386289","7":"2","_rn_":"3"},{"1":"DSV80","2":"-0.42547421","3":"0.07803986","4":"37.84127","5":"-0.58347941","6":"-0.2674690","7":"3","_rn_":"4"},{"1":"UNT","2":"0.09113761","3":"0.07803986","4":"37.84127","5":"-0.06686758","6":"0.2491428","7":"4","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>m1 &lt;- data.frame(m1)

m1$emmean2 &lt;- (1 - exp(m1$emmean))*100
m1$lower.CL2 &lt;- (1 - exp(m1$lower.CL))*100
m1$upper.CL2 &lt;- (1 - exp(m1$upper.CL))*100</code></pre>
<pre class="r"><code>m1 %&gt;% 
  select(treatment, emmean2, lower.CL2, upper.CL2) %&gt;% 
    filter(emmean2 &gt; 30) %&gt;% 
  ggplot(aes(treatment, emmean2))+
  geom_point(size = 3)+
  geom_errorbar(aes(ymax = upper.CL2, ymin = lower.CL2), width =0.1)+
  labs(y = &quot;Severity reduction (%)&quot;, 
       x = &quot;Treatment&quot;)+
  ylim(0,100)</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
<div id="audpc-1" class="section level3">
<h3>AUDPC</h3>
<p>We fit the same model now for the trials where AUDPC was obtained.</p>
<pre class="r"><code>control_audpc &lt;- datws4 %&gt;%
  mutate(effect_audpc = log(audpc / mean_audpc_check))
fit2 &lt;- lmer(effect_audpc ~ treatment + (1 | trial_number), data = control_audpc)
summary(fit2)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: effect_audpc ~ treatment + (1 | trial_number)
##    Data: control_audpc
## 
## REML criterion at convergence: 755.3
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6846 -0.5824  0.0796  0.6446  3.3268 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  trial_number (Intercept) 0.3239   0.5691  
##  Residual                 0.3571   0.5976  
## Number of obs: 384, groups:  trial_number, 16
## 
## Fixed effects:
##                 Estimate Std. Error t value
## (Intercept)    -0.008263   0.160698  -0.051
## treatmentCAL   -1.346756   0.105643 -12.748
## treatmentDSV50 -1.150754   0.105643 -10.893
## treatmentDSV80 -0.608543   0.105643  -5.760
## treatmentDVIP6 -1.745819   0.105676 -16.521
## treatmentDVIP9 -1.407676   0.105643 -13.325
## 
## Correlation of Fixed Effects:
##             (Intr) trtCAL tDSV50 tDSV80 tDVIP6
## treatmntCAL -0.329                            
## trtmntDSV50 -0.329  0.500                     
## trtmntDSV80 -0.329  0.500  0.500              
## trtmntDVIP6 -0.329  0.500  0.500  0.500       
## trtmntDVIP9 -0.329  0.500  0.500  0.500  0.500</code></pre>
<pre class="r"><code>AIC(fit2)</code></pre>
<pre><code>## [1] 771.3408</code></pre>
<pre class="r"><code>Anova(fit2)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"359.6301","2":"5","3":"1.477535e-75","_rn_":"treatment"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Means comparison</p>
<pre class="r"><code>m2 &lt;- emmeans(fit2, ~treatment)
m2 &lt;- multcomp::cld(m2)
m2 &lt;- data.frame(m2)
m2</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["treatment"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["emmean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"DVIP6","2":"-1.754082352","3":"0.1607202","4":"22.27836","5":"-2.0871544","6":"-1.4210104","7":"1","_rn_":"5"},{"1":"DVIP9","2":"-1.415939110","3":"0.1606983","4":"22.26715","5":"-1.7489752","6":"-1.0829030","7":"2","_rn_":"6"},{"1":"CAL","2":"-1.355018869","3":"0.1606983","4":"22.26715","5":"-1.6880550","6":"-1.0219828","7":"2","_rn_":"2"},{"1":"DSV50","2":"-1.159016869","3":"0.1606983","4":"22.26715","5":"-1.4920530","6":"-0.8259808","7":"2","_rn_":"3"},{"1":"DSV80","2":"-0.616806518","3":"0.1606983","4":"22.26715","5":"-0.9498426","6":"-0.2837704","7":"3","_rn_":"4"},{"1":"UNT","2":"-0.008263043","3":"0.1606983","4":"22.26715","5":"-0.3412992","6":"0.3247731","7":"4","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Transform to percent control:</p>
<pre class="r"><code>m2$emmean2 &lt;- (1 - exp(m2$emmean))*100
m2$lower.CL2 &lt;- (1 - exp(m2$lower.CL))*100
m2$upper.CL2 &lt;- (1 - exp(m2$upper.CL))*100
m2 %&gt;% 
  select(treatment, emmean2, lower.CL2, upper.CL2)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["treatment"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["emmean2"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lower.CL2"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["upper.CL2"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"DVIP6","2":"82.6934017","3":"87.59604","4":"75.85301","_rn_":"5"},{"1":"DVIP9","2":"75.7302413","3":"82.60479","4":"66.13889","_rn_":"6"},{"1":"CAL","2":"74.2057573","3":"81.51212","4":"64.01193","_rn_":"2"},{"1":"DSV50","2":"68.6205470","3":"77.50896","4":"56.21946","_rn_":"3"},{"1":"DSV80","2":"46.0334901","3":"61.31981","4":"24.70605","_rn_":"4"},{"1":"UNT","2":"0.8228998","3":"28.91538","4":"-38.37166","_rn_":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Produce the plot:</p>
<pre class="r"><code>m2 %&gt;% 
  select(treatment, emmean2, lower.CL2, upper.CL2) %&gt;% 
  filter(emmean2 &gt; 30) %&gt;% 
  ggplot(aes(treatment, emmean2))+
  geom_point(size = 3)+
  geom_errorbar(aes(ymax = upper.CL2, ymin = lower.CL2), width =0.1)+
  labs(y = &quot;AUDPC reduction (%)&quot;, 
       x = &quot;Treatment&quot;)+
  ylim(0,100)</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="yield-response" class="section level3">
<h3>Yield response</h3>
<p>Differently from the disease variables, we will focus on an absolute metric, which is the yield difference between the system and the untreated check.</p>
<pre class="r"><code>control_yld &lt;- datws3 %&gt;%
  mutate(effect_yld = yld - mean_yld_check)
fit3 &lt;- lmer(effect_yld ~ treatment + (1 | trial_number), data = control_yld)
fit4 &lt;- lmer(effect_yld ~ treatment*sev_class + (1 | trial_number), data = control_yld)
anova(fit3, fit4)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Df"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["AIC"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["BIC"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["logLik"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["deviance"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Chisq"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Chi Df"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"8","2":"9632.000","3":"9667.386","4":"-4808.000","5":"9616.000","6":"NA","7":"NA","8":"NA","_rn_":"fit3"},{"1":"14","2":"9620.371","3":"9682.296","4":"-4796.185","5":"9592.371","6":"23.62952","7":"6","8":"0.0006108619","_rn_":"fit4"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>summary(fit3)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: effect_yld ~ treatment + (1 | trial_number)
##    Data: control_yld
## 
## REML criterion at convergence: 9554
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.0233 -0.6590 -0.0403  0.6483  3.3274 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  trial_number (Intercept) 202640   450.2   
##  Residual                 315565   561.8   
## Number of obs: 616, groups:  trial_number, 27
## 
## Fixed effects:
##                  Estimate Std. Error t value
## (Intercept)    -1.842e-11  1.021e+02   0.000
## treatmentCAL    1.057e+03  7.644e+01  13.831
## treatmentDSV50  9.753e+02  7.644e+01  12.758
## treatmentDSV80  5.374e+02  7.644e+01   7.031
## treatmentDVIP6  1.261e+03  8.044e+01  15.681
## treatmentDVIP9  1.129e+03  8.042e+01  14.035
## 
## Correlation of Fixed Effects:
##             (Intr) trtCAL tDSV50 tDSV80 tDVIP6
## treatmntCAL -0.374                            
## trtmntDSV50 -0.374  0.500                     
## trtmntDSV80 -0.374  0.500  0.500              
## trtmntDVIP6 -0.356  0.475  0.475  0.475       
## trtmntDVIP9 -0.356  0.475  0.475  0.475  0.470</code></pre>
<pre class="r"><code>Anova(fit3)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"363.5723","2":"5","3":"2.09202e-76","_rn_":"treatment"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<pre class="r"><code>m_class &lt;- emmeans(fit4, ~treatment*sev_class)
multcomp::cld(m_class)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["treatment"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["sev_class"],"name":[2],"type":["fctr"],"align":["left"]},{"label":["emmean"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[7],"type":["dbl"],"align":["right"]},{"label":[".group"],"name":[8],"type":["chr"],"align":["left"]}],"data":[{"1":"UNT","2":"High","3":"-3.264353e-11","4":"128.1345","5":"41.48655","6":"-258.6808","7":"258.6808","8":"12","_rn_":"1"},{"1":"UNT","2":"Low","3":"8.972308e-12","4":"167.0670","5":"41.48655","6":"-337.2785","7":"337.2785","8":"1 3","_rn_":"7"},{"1":"DSV80","2":"Low","3":"4.564606e+02","4":"167.0670","5":"41.48655","6":"119.1821","7":"793.7392","8":"2 45","_rn_":"10"},{"1":"DSV80","2":"High","3":"5.850866e+02","4":"128.1345","5":"41.48655","6":"326.4058","7":"843.7675","8":"34 6","_rn_":"4"},{"1":"DSV50","2":"Low","3":"7.006125e+02","4":"167.0670","5":"41.48655","6":"363.3340","7":"1037.8910","8":"2 4567","_rn_":"9"},{"1":"DVIP9","2":"Low","3":"8.334710e+02","4":"173.9829","5":"48.43977","6":"483.7370","7":"1183.2049","8":"45678","_rn_":"12"},{"1":"DVIP6","2":"Low","3":"8.791491e+02","4":"173.9829","5":"48.43977","6":"529.4152","7":"1228.8831","8":"45678","_rn_":"11"},{"1":"CAL","2":"Low","3":"1.006216e+03","4":"167.0670","5":"41.48655","6":"668.9372","7":"1343.4943","8":"678","_rn_":"8"},{"1":"CAL","2":"High","3":"1.087360e+03","4":"128.1345","5":"41.48655","6":"828.6795","7":"1346.0411","8":"5 7","_rn_":"2"},{"1":"DSV50","2":"High","3":"1.136880e+03","4":"128.1345","5":"41.48655","6":"878.1989","7":"1395.5605","8":"5 7","_rn_":"3"},{"1":"DVIP9","2":"High","3":"1.291418e+03","4":"130.9902","5":"45.13929","6":"1027.6128","7":"1555.2234","8":"78","_rn_":"6"},{"1":"DVIP6","2":"High","3":"1.470524e+03","4":"131.0160","5":"45.17083","6":"1206.6714","7":"1734.3758","8":"8","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Compare means:</p>
<pre class="r"><code>m3 &lt;- emmeans(fit3, ~treatment)
m3 &lt;- CLD(m3)
m3$emmean2 &lt;- round(m3$emmean, 2)
m3</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["treatment"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["emmean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".group"],"name":[7],"type":["chr"],"align":["left"]},{"label":["emmean2"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"UNT","2":"-1.842241e-11","3":"102.1131","4":"43.68464","5":"-205.8374","6":"205.8374","7":"1","8":"0.00","_rn_":"1"},{"1":"DSV80","2":"5.374474e+02","3":"102.1131","4":"43.68464","5":"331.6100","6":"743.2847","7":"2","8":"537.45","_rn_":"4"},{"1":"DSV50","2":"9.752993e+02","3":"102.1131","4":"43.68464","5":"769.4619","6":"1181.1366","7":"3","8":"975.30","_rn_":"3"},{"1":"CAL","2":"1.057307e+03","3":"102.1131","4":"43.68464","5":"851.4694","6":"1263.1441","7":"34","8":"1057.31","_rn_":"2"},{"1":"DVIP9","2":"1.128765e+03","3":"105.1320","4":"48.82441","5":"917.4754","6":"1340.0551","7":"34","8":"1128.77","_rn_":"6"},{"1":"DVIP6","2":"1.261375e+03","3":"105.1460","4":"48.84739","5":"1050.0591","6":"1472.6902","7":"4","8":"1261.37","_rn_":"5"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Let’s produce a table with the estimate of yield response and the mean number of sprays.</p>
<pre class="r"><code>mean_yld_gain &lt;- tibble(m3$treatment, m3$emmean2, m3$lower.CL, m3$upper.CL)
colnames(mean_yld_gain) &lt;- c(&quot;treatment&quot;, &quot;meanD&quot;, &quot;lcl&quot;, &quot;ucl&quot;)

mean_applications &lt;- tibble(mean_sprays$treatment, mean_sprays$mean_spray2)
colnames(mean_applications) &lt;- c(&quot;treatment&quot;, &quot;mean_sprays&quot;)

mean_gain &lt;- left_join(mean_yld_gain, mean_applications)

mean_gain</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["treatment"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["meanD"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["lcl"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["ucl"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["mean_sprays"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"UNT","2":"0.00","3":"-205.8374","4":"205.8374","5":"NA"},{"1":"DSV80","2":"537.45","3":"331.6100","4":"743.2847","5":"1.896552"},{"1":"DSV50","2":"975.30","3":"769.4619","4":"1181.1366","5":"3.413793"},{"1":"CAL","2":"1057.31","3":"851.4694","4":"1263.1441","5":"4.137931"},{"1":"DVIP9","2":"1128.77","3":"917.4754","4":"1340.0551","5":"4.166667"},{"1":"DVIP6","2":"1261.37","3":"1050.0591","4":"1472.6902","5":"4.700000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Produce the plot:</p>
<pre class="r"><code>mean_gain %&gt;% 
  filter(meanD &gt; 400) %&gt;% 
  ggplot(aes(treatment, meanD))+
  geom_point(size = 3)+
  geom_errorbar(aes(ymax = ucl, ymin = lcl), width = 0.1)+
  ylim(100, 1500)</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
</div>
<div id="profitability" class="section level2">
<h2>Profitability</h2>
<div id="at-the-trial-level" class="section level3">
<h3>At the trial level</h3>
<p>Here we will calculate the profitability of the treatments for each of the trials. The idea is to check whether there was an economic benefit from using the recommended fungicide sprays following the systems. First, we need the mean and standard deviation for each treatment.</p>
<pre class="r"><code>prof &lt;- datws3 %&gt;%
  filter(treatment != &quot;UNT&quot;) %&gt;%
  filter(mean_yld_check &gt; 0) %&gt;%
  group_by(trial_number, harvest_season, trial_code, treatment, treatment_type, n_spray, mean_yld_check, planting_order, sev_class, planting_month) %&gt;%
  summarize(
    mean_yld = mean(yld),
    sd_yld = sd(yld)
  )</code></pre>
<p>Here we set the scenario for the economic analysis. For nows, let’s assume fixed values for all trials:</p>
<ul>
<li>fungicide price: 25 dol</li>
<li>soybean price: 440 dol</li>
<li>operational cost: 10</li>
<li>profit: 0 (zero is break even point)</li>
<li>number of blocks/reps: 4</li>
</ul>
<pre class="r"><code>prof$fungicide_price &lt;- 25
prof$soybean_price &lt;- 440
prof$operational_cost &lt;- 10
prof$profit &lt;-  0# zero is break even point
prof$number_blocks &lt;- 4</code></pre>
<p>Create the variables: D = yield difference C = fungicide + application costs P = soybean price delta = yield gain above break even point ploss = risk of not offsetting the costs</p>
<pre class="r"><code>prof1 &lt;- prof %&gt;%
  mutate(
    D = mean_yld - mean_yld_check, # yield difference 
    C = n_spray * (fungicide_price + operational_cost), # fungicide and application costs
    P = soybean_price / 1000, # crop price
    delta = D - ((C / P) + (profit / P)), 
    profit2 = delta / sd_yld * sqrt(0.5),
    ploss = 1 - (pt(profit2, (number_blocks + number_blocks - 2)))
  ) %&gt;%
  mutate(decision = case_when(  # identify trials with low risk of not recovering the cost
    ploss &lt; 0.5 ~ &quot;0&quot;,
    ploss &gt;= 0.5 ~ &quot;1&quot;
  ))</code></pre>
<p>Let’s plot the yield responses irrespectively of the costs.</p>
<pre class="r"><code>p_gain &lt;- prof1 %&gt;% 
  ggplot(aes(x= D, fill = delta))+
  geom_histogram(color = &quot;white&quot;, bins = 20, fill = &quot;steelblue&quot;)+
     geom_vline(xintercept =  0.5, linetype = 2)+
  labs(x = &quot;Yield response (D)&quot;, y = &quot;Frequency&quot;,
       fill = &quot;Risk&quot;)</code></pre>
<p>Let’s plot the yield responses above the break-even point.</p>
<pre class="r"><code>p_bpoint &lt;- prof1 %&gt;% 
  ggplot(aes(x= delta, fill = delta))+
  geom_histogram(color = &quot;white&quot;, bins = 20, fill = &quot;steelblue&quot; )+
     geom_vline(xintercept =  0.5, linetype = 2)+
  labs(x = &quot;Yield response to break-even&quot;, y = &quot;Frequency&quot;,
       fill = &quot;Risk&quot;)</code></pre>
<p>And now the distribution of treatments with the respective risk of not offsetting the costs.</p>
<pre class="r"><code>p_risk &lt;- prof1 %&gt;% 
  ggplot(aes(x= ploss, fill = ploss))+
  geom_histogram(aes(fill = ..x..), color = &quot;white&quot;, bins = 20 ) + 
         scale_fill_gradient(low=&#39;steelblue&#39;,  high=&#39;steelblue&#39;)+
     geom_vline(xintercept =  0.5, linetype = 2)+
  theme(legend.position = &quot;none&quot;)+
  labs(x = &quot;Probability of loss&quot;, y = &quot;Frequency&quot;,
       fill = &quot;Risk&quot;)</code></pre>
<p>We do the same but now conditioned to the treatments.</p>
<pre class="r"><code>p_loss_treat &lt;- prof1 %&gt;%
  ggplot(aes(treatment, ploss, fill = treatment_type, group = treatment)) +
  geom_boxplot(outlier.colour = &quot;NA&quot;) +
  scale_fill_futurama()+
  theme(legend.position = &quot;bottom&quot;)+
  labs(x = &quot;Probability of loss&quot;, y = &quot;&quot;, fill = &quot;System&quot;)+
  geom_jitter(width = 0.05, color = &quot;grey80&quot;, size = 2) +
    geom_hline(yintercept = 0.5, linetype = 2) </code></pre>
</div>
</div>
<div id="figure-3" class="section level2">
<h2>Figure 3</h2>
<pre class="r"><code>plot_grid( p_gain, p_bpoint, p_risk, p_loss_treat,  ncol = 2, align = &quot;h&quot;, axis = &quot;bt&quot;, labels = LETTERS )</code></pre>
<p><img src="code_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;figs/figure3.png&quot;, width = 10, height = 7)</code></pre>
</div>
<div id="overall-mean-risk" class="section level2">
<h2>Overall mean risk</h2>
<p>Now we will summarize the means of risk using the same mixed model we used before to estimate mean control and response.</p>
<pre class="r"><code>fit1 &lt;- lmer(ploss ~ treatment + (1 | trial_number), data = prof1)
summary(fit1)</code></pre>
<pre><code>## Linear mixed model fit by REML [&#39;lmerMod&#39;]
## Formula: ploss ~ treatment + (1 | trial_number)
##    Data: prof1
## 
## REML criterion at convergence: 0.7
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -1.6030 -0.5503 -0.1946  0.4403  3.4871 
## 
## Random effects:
##  Groups       Name        Variance Std.Dev.
##  trial_number (Intercept) 0.02418  0.1555  
##  Residual                 0.03857  0.1964  
## Number of obs: 127, groups:  trial_number, 27
## 
## Fixed effects:
##                 Estimate Std. Error t value
## (Intercept)     0.211330   0.048208   4.384
## treatmentDSV50 -0.014013   0.053454  -0.262
## treatmentDSV80  0.112920   0.053454   2.112
## treatmentDVIP6 -0.063848   0.056213  -1.136
## treatmentDVIP9 -0.004952   0.056213  -0.088
## 
## Correlation of Fixed Effects:
##             (Intr) tDSV50 tDSV80 tDVIP6
## trtmntDSV50 -0.554                     
## trtmntDSV80 -0.554  0.500              
## trtmntDVIP6 -0.527  0.475  0.475       
## trtmntDVIP9 -0.527  0.475  0.475  0.469</code></pre>
<pre class="r"><code>Anova(fit1)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Chisq"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["Df"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["Pr(>Chisq)"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"11.12972","2":"4","3":"0.02514421","_rn_":"treatment"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>As we can see, no difference was found among the treatments.</p>
<pre class="r"><code>library(emmeans)
m1 &lt;- lsmeans(fit1, ~treatment)
m1 &lt;- multcomp::cld(m1)
m1 &lt;- data.frame(m1)
m1</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["treatment"],"name":[1],"type":["fctr"],"align":["left"]},{"label":["lsmean"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["SE"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["df"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["lower.CL"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["upper.CL"],"name":[6],"type":["dbl"],"align":["right"]},{"label":[".group"],"name":[7],"type":["chr"],"align":["left"]}],"data":[{"1":"DVIP6","2":"0.1474818","3":"0.05129249","4":"87.79820","5":"0.04554549","6":"0.2494181","7":"1","_rn_":"4"},{"1":"DSV50","2":"0.1973168","3":"0.04820842","4":"78.34446","5":"0.10134789","6":"0.2932858","7":"12","_rn_":"2"},{"1":"DVIP9","2":"0.2063779","3":"0.05129249","4":"87.79820","5":"0.10444160","6":"0.3083142","7":"12","_rn_":"5"},{"1":"CAL","2":"0.2113297","3":"0.04820842","4":"78.34446","5":"0.11536078","6":"0.3072987","7":"12","_rn_":"1"},{"1":"DSV80","2":"0.3242493","3":"0.04820842","4":"78.34446","5":"0.22828034","6":"0.4202182","7":"2","_rn_":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>



Copyright 2019 Emerson Del Ponte


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = false;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
